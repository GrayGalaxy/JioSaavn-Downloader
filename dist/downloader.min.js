const __c=str=>str.charAt(0).toUpperCase()+str.slice(1),songData=(song,i)=>{const url=song.media_preview_url.replace("preview.saavncdn.com","aac.saavncdn.com"),array={id:song.id,title:__c(song.song),album:__c(song.album),prim_artists:song.primary_artists,singers:song.singers,image:song.image,url:url.replace("_96_p","_160"),hd_content:song["320kbps"],year:song.year,date:song.release_date,buffer_url:{96:url,160:url.replace("_96_p","_160"),320:url.replace("_96_p","_320")}};return i&&(array.track=i),song.language&&"unknown"!=song.language&&(array.language=__c(song.language)),array},songsArray=(source,track)=>{var songs=[],i=1;return source.forEach(song=>songs.push(songData(song,track&&i++))),songs},responseJSON=response=>JSON.parse(JSON.stringify(response).replace(/&amp;/gi,"&").replace(/&copy;/gi,"Â©").replace(/150x150/gi,"500x500").replace(/&#039;/,"'")),getTheID=(token,type)=>{const url=`https://www.jiosaavn.com/api.php?__call=webapi.get&ctx=wap6dot0&api_version=4&_format=json&_marker=0%3F_marker%3D0&type=${type}&token=${token}`,id=fetch(url).then(res=>res.json()).then(res=>"song"==type?res.songs[0].id:res.id);return id},getSongsData=async(type,token,callback)=>{var id=await getTheID(token,type),data={};"album"==type&&(data={albumid:id,__call:"content.getAlbumDetails"}),"playlist"==type&&(data={listid:id,__call:"playlist.getDetails"}),"song"==type&&(data={pids:id,__call:"song.getDetails"}),$.ajax({url:"https://www.jiosaavn.com/api.php?_format=json&_marker=0",dataType:"json",data:data,success:res=>{res=responseJSON(res);var result={};result="song"==type?songData(res[id]):{id:res.albumid||res.listid,title:res.title||res.listname,image:res.image,songs:songsArray(res.songs,"album"==type)},console.log("songs =>",result),callback(result,!0)},error:res=>callback(res,!1)})},getURLArrayBuffer=(url,onload,onprogress,onerror)=>{const xhr=new XMLHttpRequest;xhr.open("GET",url,!0),xhr.responseType="arraybuffer",onprogress&&(xhr.onprogress=e=>{const progress=e.loaded/e.total;onprogress(progress<1&&progress)}),xhr.onload=()=>{200===xhr.status?onload(xhr.response):(console.warn("Requested URL Forbiden !"),onprogress&&onprogress(!1),onerror&&onerror())},xhr.send()},getSongBlob=(song,success,error)=>{const bit=parseInt(localStorage.download_bitrate);var cover=song.image.replace("c.saavncdn.com","corsdisabledimage.tuhinwin.workers.dev");getURLArrayBuffer(cover,coverArrayBuffer=>{const url_raw=song.url.replace("aac.saavncdn.com","corsdisabledsong.tuhinwin.workers.dev");var extension=".mp3";(bit<=64||320==bit&&song.hd_content)&&(extension=`_${bit}.mp3`);const songUrl=url_raw.substr(0,url_raw.lastIndexOf("_"))+extension;getURLArrayBuffer(songUrl,arrayBuffer=>{const writer=new ID3Writer(arrayBuffer),{title:title,album:album,prim_artists:prim_artists,singers:singers,year:year,language:language,track:track,label:label=""}=song;language&&writer.setFrame("TCON",[__c(language)]),track&&writer.setFrame("TRCK",track),writer.setFrame("TIT2",title).setFrame("TPE2",prim_artists.split(", ")).setFrame("TPE1",singers.split(", ")).setFrame("TALB",album).setFrame("TYER",year).setFrame("TBPM",bit).setFrame("TPUB",label).setFrame("APIC",{type:3,data:coverArrayBuffer,description:title}),writer.addTag();const blob=writer.getBlob();success(blob)},value=>showProgress(song.title,song.id,value),()=>error&&error())})},downloadWithData=(song,onSuccess,onError)=>{getSongBlob(song,blob=>{saveAs(blob,`${song.title}.mp3`),onSuccess&&onSuccess()},()=>{onError&&onError()})},downloadSongsAsZip=function(list,name,onSuccess){var zip=new JSZip,num=0;list.forEach((song,i)=>{getSongBlob(song,blob=>{zip.file(`${song.title}.mp3`,blob),++num===list.length&&setTimeout(()=>{downloadZip(zip,name),onSuccess&&onSuccess()},1e3)},()=>num++)})},downloadZip=(zip,name,callback)=>{zip.generateAsync({type:"blob"}).then(blob=>{saveAs(blob,name),callback()})},showProgress=(name,id,value)=>{if(0==$("#download-bar").find(`#${id}`).length){const wrapper=$(`<div id="${id}" class="download-wrapper" style="--p:0.15"><div class="wrap"><svg class="progress" viewbox="0 0 24 24"><circle cx="12" cy="12" r="11"/><circle cx="12" cy="12" r="11"/><path d="M1.73,12.91 8.1,19.28 22.79,4.59"/></svg><p class="u-centi u-ellipsis u-color-js-gray-alt-light">${name}</p></div></div>`);$("#download-bar .body-scroll").append(wrapper)}const progress=$(`#download-bar #${id}`);progress.css("--p",value),$("#download-bar").addClass("active"),value||(progress.addClass("done hide"),setTimeout(()=>{progress.remove()},3250))};
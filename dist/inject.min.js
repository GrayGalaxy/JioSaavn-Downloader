const add_song_download_btn=()=>{$("li").find("figcaption").find("a.u-color-js-gray").each((function(){if(0!==$(this).parents("article.o-snippet").find(".single_download_btn").length)return;const Button=$('<div class="o-snippet__item single_download_btn"><span class="u-link"><i class="o-icon--large o-icon-download"></i></span></div>'),icon=Button.find("span").find("i.o-icon--large");try{var token=this.href.match(/.*\/(.*)/)[1]}catch(e){return}Button.on("click",e=>{e.preventDefault(),icon.removeClass("o-icon-download").addClass("o-icon-download-progress");const error=()=>{toast("Sorry! Cannot download this Song"),icon.removeClass("o-icon-download-progress").addClass("o-icon-download")};getSongsData("song",token,(result,status)=>{status?(toast(`Now Downloading Song : ${result.title}`),downloadWithData(result,()=>icon.removeClass("o-icon-download-progress").addClass("o-icon-download"),()=>error())):error()})}),$(this).parents("article.o-snippet").find(".o-snippet__item:nth-last-of-type(2)").before(Button)}))},add_album_download_btn=()=>{const firstBtn=$(".o-flag__body .o-layout>.o-layout__item:first-of-type"),Button=$('<p class="o-layout__item u-margin-bottom-none@sm album_download_btn"><a class="c-btn c-btn--tertiary c-btn--ghost c-btn--icon"><i class="o-icon--large o-icon-download"></i></a></p>'),icon=Button.find("i.o-icon--large");Button.on("click",()=>{const token=window.location.href.match(/.*\/(.*)/)[1];icon.removeClass("o-icon-download").addClass("o-icon-download-progress"),getSongsData("album",token,(result,status)=>{status?(toast(`Now Downloading Album : ${result.title}`),downloadSongsAsZip(result.songs,result.title,()=>{icon.addClass("o-icon-download").removeClass("o-icon-download-progress"),toast("Compressing & Zipping the Downloads")})):toast("Cannot download this Album")})}),0==firstBtn.parent().find($(".album_download_btn")).length&&firstBtn.after(Button)},add_playlist_download_btn=()=>{const firstBtn=$(".o-flag__body .o-layout>.o-layout__item:first-of-type"),Button=$('<p class="o-layout__item u-margin-bottom-none@sm playlist_download_btn"><a class="c-btn c-btn--tertiary c-btn--ghost c-btn--icon"><i class="o-icon--large o-icon-download"></i></a></p>');Button.on("click",()=>{const token=window.location.href.match(/.*\/(.*)/)[1];getSongsData("playlist",token,(result,status)=>{status?(toast(`Now Downloading Playlist : ${result.title}`),downloadSongsAsZip(result.songs,result.title,()=>{toast("Compressing & Zipping the Downloads")})):toast("Cannot download this Playlist")})}),0==firstBtn.parent().find($(".playlist_download_btn")).length&&firstBtn.after(Button)},createDownloadQuality=()=>{var menuItem=$('<aside id="quality-dropdown" class="c-dropdown u-margin-right@sm"><div class="c-dropdown__header"><span class="c-dropdown__type"><span class="u-visible-visually@lg"></span>Qiality</span> <span class="c-dropdown__select curr_biterate"></span></div></aside>'),dropDown=$('<div class="c-dropdown__content"><div class="u-padding@sm"><h5 class="u-deci u-margin-bottom-none@sm">Download Quality</h5><p class="u-centi u-color-js-gray-alt-light u-margin-bottom-none@sm"><em>Pick a prefered quality</em></p></div><div class="o-message o-message--error">You must select a bitrate</div></div>'),dropDownList=$('<form id="song-biterate"><section class="u-scroll u-3/5-max-vh"><ul class="o-list-select"></ul></section></form>'),bitrates=["320","192","128","64","32","16"];menuItem.find(".curr_biterate").first().text(localStorage.download_bitrate+" kbps"),bitrates=bitrates.map((function(rate){var el=$(`<li class='o-list-select__item'>${rate} kbps</li>`);return rate===localStorage.download_bitrate&&el.addClass("selected"),el.on("click",e=>{localStorage.download_bitrate=rate,$(e.target).parent().find(".selected").removeClass("selected"),$(e.target).addClass("selected"),menuItem.find(".curr_biterate").first().text(`${localStorage.download_bitrate} kbps`),toast(`Download Quality changed to ${localStorage.download_bitrate}kbps`)}),el})),$(document).on("click",(function(e){$(e.target).closest("#quality-dropdown").length?$("#quality-dropdown").toggleClass("active"):$("#quality-dropdown").removeClass("active")})),dropDownList.append(bitrates),dropDown.append(dropDownList),menuItem.append(dropDown),$(menuItem).insertAfter($("#language-dropdown"))},download_progress=()=>{const wrapper='<div id="download-bar"><div class="body-scroll"></div><div class="head"><i class="o-icon-download icon"></i><label>Downloads</label></div></div>';0==$("#download-bar").length&&$(".c-player").after(wrapper)};var hideAds=()=>{$("body").removeClass("promo"),$(".banner").removeClass("banner");const ads=[".ad",".c-promo",".c-ad",".c-banner",".c-player__ad"];ads.forEach(el=>{el&&$(el).remove()})};const toast=message=>{$('<div class="c-toast__msg" />').html(message).appendTo($('<div class="c-toast__row cStm" />').appendTo($(".c-player ~ .c-toast")));const msgContainer=$(".c-player ~ .c-toast .c-toast__row.cStm");setTimeout(()=>msgContainer.addClass("active"),0),setTimeout(()=>{msgContainer.removeClass("active"),msgContainer.on("animationend transitionend",e=>e.target.remove())},3e3)};var initPlugin=()=>{hideAds(),add_song_download_btn(),add_album_download_btn(),add_playlist_download_btn()};$(document).ready(()=>{initPlugin(),download_progress(),createDownloadQuality(),toast("Plugin is active and Functional"),setInterval(()=>{0==$("#download-bar .body-scroll").children().length&&$("#download-bar").removeClass("active")},2e3);var oldSongListLen=0;setInterval(()=>{if($("ol.o-list-bare").find("li").length){var songListLen=$("ol.o-list-bare").find("li").length;songListLen!==oldSongListLen&&initPlugin(),oldSongListLen=songListLen}},1e3)});